# FXトレード記録・資産管理アプリ

Google Spreadsheet（GSS）からFXトレードデータを読み込み、トレーダー向けに直感的で高機能なトレード記録・資産管理ウェブアプリケーションです。

## 主要機能

### 📊 ダッシュボード
- **累積損益グラフ（資産曲線）**: 日次/週次の累積損益推移を視覚化
- **主要メトリクス**: 勝率、プロフィットファクター、平均獲得pips、最大ドローダウンなど
- **月次損益**: 棒グラフで月次パフォーマンスを表示
- **最近のトレード**: 直近10件のトレードをハイライト表示

### 🔍 詳細分析レポート
- **手法別分析**: 各手法のパフォーマンス比較、改善が必要な手法の特定
- **通貨ペア別分析**: 通貨ペアごとの収益性分析
- **時間軸分析**: 月次、曜日別、市場セッション別のパフォーマンス
- **保有時間分析**: 最適な保有時間の特定

### 📋 トレードログ
- **全トレード一覧**: フィルタリング・検索機能付き
- **多彩なフィルター**: 通貨ペア、タイプ、手法、日付範囲、損益範囲
- **CSVエクスポート**: データのダウンロード機能

### 🔄 振り返り機能
- **パターン自動抽出**: 連続損失分析、損失額トップ5、時間帯別・曜日別分析
- **振り返りコメント編集**: 各トレードに反省点や気づきを記録（GSSに保存）
- **負けトレード分析**: 失敗の共通点を発見

## データ構造

アプリは以下の列名（ヘッダー）を持つGoogle Spreadsheetからデータを読み込みます：

| システム利用名 | 日本語表示 | データ型 | 説明 |
|-------------|----------|--------|------|
| trade_id | 取引番号 | 数値 | ユニークな取引ID |
| currency_pair | 通貨ペア | 文字列 | 例: GBPUSD, USDJPY |
| type | タイプ | 文字列 | 例: #buy, #sell |
| lot | ロット | 小数 | 取引ロット数 |
| start_time | 開始時刻 | 日時 | エントリー時刻 |
| end_time | 終了時刻 | 日時 | エグジット時刻 |
| date | 日付 | 日付 | 取引日 |
| profit_loss_jpy | 損益 | 数値 | 日本円での純損益 |
| pips | pips | 小数 | 獲得pips |
| holding_time_sec | 保有時間(秒) | 数値 | 保有時間（秒） |
| commission | 手数料 | 数値 | 発生した手数料 |
| swap | スワップ | 数値 | 発生したスワップ |
| net_profit_loss_jpy | 合計損益 | 数値 | 最終的な損益 |
| sync_time | 同期日時 | 日時 | データ同期時刻 |
| strategy | 手法 | 文字列 | 使用した取引手法 |
| review_comment | 振り返りコメント | 文字列 | 振り返り内容 |

## セットアップ

### 1. 必要なパッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. Google Cloud サービスアカウントの設定

1. [Google Cloud Console](https://console.cloud.google.com/)でプロジェクトを作成
2. Google Sheets API と Google Drive API を有効化
3. サービスアカウントを作成し、JSONキーをダウンロード
4. ダウンロードしたJSONファイルを `credentials.json` としてプロジェクトルートに配置

### 3. 環境変数の設定

`.env` ファイルを作成し、以下の内容を設定：

```env
# Google Sheets設定
GOOGLE_SHEETS_ENABLED=true
GOOGLE_SHEETS_CREDENTIALS_FILE=credentials.json
GOOGLE_SHEETS_SPREADSHEET_ID=your_spreadsheet_id_here

# Notion設定（オプション）
NOTION_API_KEY=your_notion_api_key
NOTION_DATABASE_ID=your_notion_database_id
```

**スプレッドシートIDの取得方法:**
- Google SpreadsheetのURLから取得: `https://docs.google.com/spreadsheets/d/【ここがスプレッドシートID】/edit`

### 4. Google Spreadsheetの準備

1. Google Spreadsheetを新規作成または既存のシートを使用
2. 上記のデータ構造に従って列ヘッダーを設定
3. サービスアカウントのメールアドレス（`credentials.json`内）にシートの編集権限を付与

### 5. アプリケーションの起動

```bash
streamlit run app.py
```

ブラウザが自動的に開き、アプリケーションが表示されます（デフォルト: http://localhost:8501）

## 使い方

### 基本的な操作フロー

1. **データの読み込み**
   - アプリ起動時に自動的にGoogle Spreadsheetからデータを読み込みます
   - サイドバーの「データ更新」ボタンで手動更新も可能

2. **ダッシュボードで全体像を把握**
   - 総損益、勝率、プロフィットファクターなどの主要指標を確認
   - 累積損益グラフで資産の推移を視覚化

3. **詳細分析で深掘り**
   - 手法別、通貨ペア別、時間帯別など多角的に分析
   - パフォーマンスの良い/悪い要素を特定

4. **トレードログで個別確認**
   - フィルター機能で特定条件のトレードを抽出
   - 詳細な取引履歴を確認

5. **振り返り機能で改善**
   - 負けトレードの共通点を分析
   - 各トレードに振り返りコメントを記録
   - パターン分析で弱点を発見

### 振り返りコメントの編集

1. 「振り返り」ページを開く
2. 「振り返りコメント編集」タブを選択
3. トレードを選択し、コメントを入力
4. 「コメントを保存」ボタンをクリック
5. Google Spreadsheetに自動的に保存されます

## 技術スタック

- **バックエンド**: Python 3.8+
- **フロントエンド**: Streamlit
- **データ処理**: Pandas, NumPy
- **可視化**: Plotly
- **データソース**: Google Sheets API
- **認証**: Google OAuth 2.0 (Service Account)

## プロジェクト構造

```
FX/
├── app.py                      # メインアプリケーション（Streamlit）
├── src/
│   ├── config.py              # 設定管理
│   ├── data_manager.py        # データ管理・分析モジュール
│   ├── sheets_client.py       # Google Sheets API クライアント（既存）
│   └── __pycache__/
├── credentials.json           # Google Cloud サービスアカウントキー
├── .env                       # 環境変数
├── requirements.txt           # 依存パッケージ
├── README.md                  # このファイル
└── logs/                      # ログファイル
```

## 主要なメトリクス計算式

### 勝率
$$\text{勝率} = \frac{\text{勝ちトレード数}}{\text{総取引回数}} \times 100\%$$

### プロフィットファクター（PF）
$$\text{PF} = \frac{\text{総利益}}{\text{総損失}}$$

### 最大ドローダウン（MDD）
累積損益の最大値からの最大下落幅

## トラブルシューティング

### データが表示されない
- `.env` ファイルでスプレッドシートIDが正しく設定されているか確認
- `credentials.json` が正しい場所に配置されているか確認
- サービスアカウントにスプレッドシートの閲覧・編集権限があるか確認

### 振り返りコメントが保存できない
- サービスアカウントにスプレッドシートの編集権限があるか確認
- スプレッドシートに「振り返りコメント」列が存在するか確認（自動作成されます）

### エラーメッセージが表示される
- ターミナルのエラーログを確認
- 必要なパッケージがすべてインストールされているか確認: `pip install -r requirements.txt`

## 今後の拡張案

- [ ] リアルタイムデータ更新（WebSocket）
- [ ] より高度なテクニカル分析指標の追加
- [ ] 機械学習による勝率予測
- [ ] モバイル対応
- [ ] 複数のスプレッドシート対応
- [ ] バックテスト機能
- [ ] PDFレポート自動生成

## ライセンス

このプロジェクトは個人利用を目的としています。

## サポート

問題が発生した場合は、以下を確認してください：
1. Pythonのバージョン（3.8以上推奨）
2. 依存パッケージのバージョン
3. Google Cloud の設定
4. スプレッドシートの権限設定

---

**開発者へ**: このアプリケーションはトレーダーのパフォーマンス向上を支援するツールです。継続的な改善と振り返りが成功への鍵となります。
